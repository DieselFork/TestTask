>Предисловие<br>
>Иностранные термины в технической документации можно использовать в исходном варианте *feature release, merge request, milestone* и т.д., записывать с помощью транскрипции - *фича релиз, мердж реквест, майлстоун* с целью сохранения исходного звучания или же переводить. Такие моменты определяются заранее в стайлгадах компании и данном случае я решил использовать вариант с транскрибированием для выдерживания единого стиля.

# Формирование релиза

## Подготовка мердж-реквестов

### Фича-релиз

#### Общее

Релизные ветки должны быть созданы во всех пакетах до **15:00 понедельника**. 
Уведомлять о создании релизной ветки в общем чате разработки необходимо заранее. 

Ответственный за релиз может создать [*майлстоун*](https://docs.gitlab.com/ee/user/project/milestones/) для группы разработчиков в Pulse . Разработчики, работающие над текущим релизом, для удобства могут добавлять ко всем *мердж-реквестам* данный *майлстоун*. Рекомендуемое название *майлстоуна* - версия подготавливаемого релиза в формате `vX.X.X`.

>[!Tip]
>При создании *майлстоуна* не забудьте преобразовать его в [групповой](https://docs.gitlab.com/ee/user/project/milestones/#promote-a-project-milestone-to-a-group-milestone).

#### Подготовка релизной ветки

Подготовка релизной ветки выполняется в следующем порядке:
1. Проверьте, что в релизной ветке присутствует *чендж-лог* в [новом формате](https://faq-changelog-format/). Если формат отличается — сообщите ответственному за релизную ветку.
2. Убедитесь, что дата формирования релиза в *ченджлоге* совпадает с релизной версией (дата во всех пакетах - дата сбора релиза). 
3. Проверьте *ченджлог* - в нем должен быть только один пул изменений с одинаковой датой или версией релиза.
4. Проверьте [формат](https://faq-merge-commit-format/) *коммит-сообщений*. Если отличается - сообщите автору *коммита*.
5. Проверьте версию пакета:
   - формат версии должен быть - `X.X.0`;
   - номер версии должен совпадать с номером в названии ветки;
   - версия данного пакета  должна быть последняя по *чендж-логу*; 
   - номер версии должен соответствать файлу `VERSION`;
   - в версии не должен содержаться *фикс* (т.е. формат версии `X.X.X`).

>[!WARNING]
>Если в версии содержится *фикс* — сообщите ответственному за релиз: будет выполнен *бамп*.

6. Проверьте, что репозиторий переведен на использование шаблонов `Gitlab CI` с версией не ниже `v1.4.4`.

>[!WARNING]
>Убедитесь, что в файле `.gitlab-ci.yml` в разделе `include` прописан один из файлов `common_stages*.yml`, а не шаблоны из директории `stages`.

7. Проверьте подключение `SonarQube` в репозитории. На странице *мердж-реквеста* должна присутствовать плашка-сообщение с результатом `SonarQube`. Если сообщение с результатом `SonarQube` отсутствует - связка сервера `SonarQube` с репозиторием выполнена некорректно. Cообщите об этом ответственному за репозиторий.
  
>[!CAUTION]
>Пакеты без проверки в `SonarQube` не попадают в релиз.

8. Убедитесь, что в пакете успешно завершён *пайплайн*. Проверить статус *пайплайна* можно в разделе `Build - Pipelines`.
9. Проверьте название *мердж-реквеста* на соответствие [шаблону](https://faq-merge-request-format/).
10. Убедитесь, что в описании *мердж-реквеста* присутствует актуальный *ченджлог*.
11. Убедитесь, что название ветки соответствует [формату](https://faq-release-branch-format/).

### Хотфикс релиз

>[!IMPORTANT]
>Релизная ветка хотфикса должна быть аналогично создана до 15:00 понедельника.

#### Подготовка релизной ветки

Подготовка релизной ветки *хотфикса* выполняется в следующем порядке:
1. Создайте релизную ветку по [формату](https://faq-release-branch-format/).
2. Сформируйте [*ченджлог*](https://faq-changelog-format/) на основе *мердж-реквеста* текущего спринта в фича-релизе и  запушьте его вместе с версией.
3. Проверьте ошибки `SonarQube`. Если есть ошибки — обратитесь к автору пакета с просьбой поправить.
4. Сформируйте [*объединённый ченджлог*](https://integrated-changelog-format/).

## Обновление версии релиза

Версия фича-релиза обновляется до следующей отдельным *коммит-сообщением* со специальным названием одновременно с обновлением зависимостей в `install_dependencies_versioned.sh`.

>[!IMPORTANT]
>*Коммит-сообщение* добавляем в последнюю очередь, т.к. могут быть фиксы в релизной ветке в процессе тестирования релиза.
